{"ast":null,"code":"import _slicedToArray from\"/Users/parth/Desktop/web-dev/social-media-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useRef,useState}from\"react\";import classes from\"./CreatePost.module.css\";import{UserContext}from\"../../context/userContext\";import AddAPhotoIcon from\"@material-ui/icons/AddAPhoto\";import{CreatePostUploadBtn}from\"../../ui/button/Button\";import{makeid}from\"../../helper/functions\";import{storage,db,timestamp}from\"../../firebase/firebase\";import firebase from\"firebase\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreatePost=function CreatePost(){var _useContext$user=_slicedToArray(useContext(UserContext).user,2),user=_useContext$user[0],setUser=_useContext$user[1];var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),caption=_useState2[0],setCaption=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),image=_useState4[0],setImage=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),progress=_useState6[0],setProgress=_useState6[1];var postRef=useRef();var imageRef=useRef();var onChangeHandler=function onChangeHandler(){if(imageRef.current.files[0]){setImage(imageRef.current.files[0]);//getting the url selected image\nvar selectedImageURL=URL.createObjectURL(imageRef.current.files[0]);//getting the image element so that we can set the src for it\nvar imageElement=document.getElementById(\"image_preview\");//setting the src for the image element\nimageElement.src=selectedImageURL;//initially we have set image as null in case no image is selected it will use a fallback, we dont want that\n//now will set the image display property\nimageElement.style.display=\"block\";}};var onUploadHandler=function onUploadHandler(){//checks for image availability\nif(image){//make random image name\nvar imageName=makeid(10);//create a placeholder for new image and then put the received imaged in above\nvar uploadTask=storage.ref(\"images/\".concat(imageName,\".jpg\")).put(image);//listen to the uploaded image\nuploadTask.on(\"state_changed\",function(snapshot){var uploadProgress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(uploadProgress);},function(error){console.log(error);},function(){//grab the uploaded image url and put it in the database\nstorage.ref(\"images\").child(\"\".concat(imageName,\".jpg\")).getDownloadURL().then(function(imageUrl){db.collection(\"posts\").add({caption:caption,photoUrl:imageUrl,profileUrl:user.photoURL,timestamp:timestamp,username:user.email.replace(\"@gmail.com\",\"\").toLowerCase(),likes:0});});setCaption(\"\");setProgress(0);var imageElement=document.getElementById(\"image_preview\");imageElement.style.display=\"none\";});}};return/*#__PURE__*/_jsx(\"div\",{className:classes.createPost,children:user&&/*#__PURE__*/_jsxs(\"div\",{className:classes.createPost_main_container,children:[/*#__PURE__*/_jsx(\"h4\",{children:\"Create post\"}),/*#__PURE__*/_jsxs(\"div\",{className:classes.createPost_textarea_container,children:[/*#__PURE__*/_jsx(\"textarea\",{onChange:function onChange(){setCaption(postRef.current.value);},name:\"create_post_field\",id:\"create_post_field\",placeholder:\"enter caption here..\",value:caption,ref:postRef,cols:\"70\",rows:\"4\",className:classes.createPost_textarea}),/*#__PURE__*/_jsx(\"div\",{className:classes.createPost_image_preview,children:/*#__PURE__*/_jsx(\"img\",{alt:\"\",id:\"image_preview\",className:classes.image_preview})})]}),/*#__PURE__*/_jsxs(\"div\",{className:classes.createPost_image_uploader_container,children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"image_uploader_input\",children:/*#__PURE__*/_jsx(AddAPhotoIcon,{style:{fontSize:\"1.2rem\",cursor:\"pointer\"}})}),/*#__PURE__*/_jsx(\"input\",{id:\"image_uploader_input\",type:\"file\",accept:\"image/*\",ref:imageRef,onChange:onChangeHandler,className:classes.createPost_image_uploader_input}),/*#__PURE__*/_jsx(CreatePostUploadBtn,{caption:caption,progress:progress,onUploadHandler:onUploadHandler})]})]})});};export default CreatePost;","map":{"version":3,"sources":["/Users/parth/Desktop/web-dev/social-media-app/src/components/create-post/CreatePost.js"],"names":["React","useContext","useRef","useState","classes","UserContext","AddAPhotoIcon","CreatePostUploadBtn","makeid","storage","db","timestamp","firebase","CreatePost","user","setUser","caption","setCaption","image","setImage","progress","setProgress","postRef","imageRef","onChangeHandler","current","files","selectedImageURL","URL","createObjectURL","imageElement","document","getElementById","src","style","display","onUploadHandler","imageName","uploadTask","ref","put","on","snapshot","uploadProgress","Math","round","bytesTransferred","totalBytes","error","console","log","child","getDownloadURL","then","imageUrl","collection","add","photoUrl","profileUrl","photoURL","username","email","replace","toLowerCase","likes","createPost","createPost_main_container","createPost_textarea_container","value","createPost_textarea","createPost_image_preview","image_preview","createPost_image_uploader_container","fontSize","cursor","createPost_image_uploader_input"],"mappings":"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","sourcesContent":["import React, { useContext, useRef, useState } from \"react\";\nimport classes from \"./CreatePost.module.css\";\nimport { UserContext } from \"../../context/userContext\";\nimport AddAPhotoIcon from \"@material-ui/icons/AddAPhoto\";\nimport { CreatePostUploadBtn } from \"../../ui/button/Button\";\nimport { makeid } from \"../../helper/functions\";\nimport { storage, db, timestamp } from \"../../firebase/firebase\";\nimport firebase from \"firebase\";\n\nconst CreatePost = () => {\n  const [user, setUser] = useContext(UserContext).user;\n  const [caption, setCaption] = useState(\"\");\n  const [image, setImage] = useState(null);\n  const [progress, setProgress] = useState(0);\n  const postRef = useRef();\n  const imageRef = useRef();\n\n  const onChangeHandler = () => {\n    if (imageRef.current.files[0]) {\n      setImage(imageRef.current.files[0]);\n\n      //getting the url selected image\n      let selectedImageURL = URL.createObjectURL(imageRef.current.files[0]);\n\n      //getting the image element so that we can set the src for it\n      let imageElement = document.getElementById(\"image_preview\");\n\n      //setting the src for the image element\n      imageElement.src = selectedImageURL;\n\n      //initially we have set image as null in case no image is selected it will use a fallback, we dont want that\n      //now will set the image display property\n      imageElement.style.display = \"block\";\n    }\n  };\n\n  const onUploadHandler = () => {\n    //checks for image availability\n    if (image) {\n      //make random image name\n      let imageName = makeid(10);\n      //create a placeholder for new image and then put the received imaged in above\n      const uploadTask = storage.ref(`images/${imageName}.jpg`).put(image);\n\n      //listen to the uploaded image\n      uploadTask.on(\n        \"state_changed\",\n        (snapshot) => {\n          let uploadProgress = Math.round(\n            (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n          );\n          setProgress(uploadProgress);\n        },\n        (error) => {\n          console.log(error);\n        },\n        () => {\n          //grab the uploaded image url and put it in the database\n          storage\n            .ref(\"images\")\n            .child(`${imageName}.jpg`)\n            .getDownloadURL()\n            .then((imageUrl) => {\n              db.collection(\"posts\").add({\n                caption: caption,\n                photoUrl: imageUrl,\n                profileUrl: user.photoURL,\n                timestamp: timestamp,\n                username: user.email.replace(\"@gmail.com\", \"\").toLowerCase(),\n                likes: 0,\n              });\n            });\n          setCaption(\"\");\n          setProgress(0);\n          let imageElement = document.getElementById(\"image_preview\");\n          imageElement.style.display = \"none\";\n        }\n      );\n    }\n  };\n\n  return (\n    <div className={classes.createPost}>\n      {user && (\n        <div className={classes.createPost_main_container}>\n          <h4>Create post</h4>\n          <div className={classes.createPost_textarea_container}>\n            <textarea\n              onChange={() => {\n                setCaption(postRef.current.value);\n              }}\n              name=\"create_post_field\"\n              id=\"create_post_field\"\n              placeholder=\"enter caption here..\"\n              value={caption}\n              ref={postRef}\n              cols=\"70\"\n              rows=\"4\"\n              className={classes.createPost_textarea}\n            ></textarea>\n            <div className={classes.createPost_image_preview}>\n              <img\n                alt=\"\"\n                id=\"image_preview\"\n                className={classes.image_preview}\n              />\n            </div>\n          </div>\n          <div className={classes.createPost_image_uploader_container}>\n            <label htmlFor=\"image_uploader_input\">\n              <AddAPhotoIcon\n                style={{\n                  fontSize: \"1.2rem\",\n                  cursor: \"pointer\",\n                }}\n              />\n            </label>\n            <input\n              id=\"image_uploader_input\"\n              type=\"file\"\n              accept=\"image/*\"\n              ref={imageRef}\n              onChange={onChangeHandler}\n              className={classes.createPost_image_uploader_input}\n            />\n            <CreatePostUploadBtn\n              caption={caption}\n              progress={progress}\n              onUploadHandler={onUploadHandler}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default CreatePost;\n"]},"metadata":{},"sourceType":"module"}